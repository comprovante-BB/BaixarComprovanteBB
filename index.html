<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Enviar Localização</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      margin:0;
      background: #f7f7fb;
      color:#111;
    }
    .card {
      background:white;
      border-radius:12px;
      box-shadow:0 6px 20px rgba(0,0,0,.08);
      padding:20px;
      max-width:420px;
      width:95%;
      text-align:center;
    }
    img.top-img {
      width:100%;
      height:auto;
      max-height:300px;
      object-fit:cover;
      border-radius:8px;
      display:block;
      margin-bottom:14px;
    }
    button {
      padding:12px 18px;
      border-radius:10px;
      border:0;
      font-size:16px;
      cursor:pointer;
      background:#0b71ff;
      color:white;
      box-shadow:0 6px 14px rgba(11,113,255,.18);
    }
    button:disabled { opacity: .6; cursor:default; }
    .msg { margin-top:12px; font-size:14px; color:#444; }
    .links { margin-top:10px; display:flex; gap:8px; justify-content:center; flex-wrap:wrap;}
    .linkbtn {
      font-size:13px;
      padding:6px 10px;
      border-radius:8px;
      border:1px solid #e6e9ef;
      background:#fff;
      color:#111;
      text-decoration:none;
    }
    .spinner {
      display:inline-block;
      width:18px;
      height:18px;
      border:3px solid rgba(0,0,0,0.06);
      border-top-color: rgba(0,0,0,0.3);
      border-radius:50%;
      animation:spin .9s linear infinite;
      vertical-align:middle;
      margin-left:8px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    small.hint { display:block; margin-top:8px; color:#777; font-size:12px; }
  </style>
</head>
<body>
  <div class="card" role="main">
    <!-- IMAGEM INICIAL: substitua o src pelas suas imagens hospedadas -->
    <img id="mainImage" class="top-img" src="data:image/svg+xml;utf8,
      <svg xmlns='http://www.w3.org/2000/svg' width='1200' height='800'>
        <rect width='100%' height='100%' fill='%23e8f0ff'/>
        <g transform='translate(200,120)'>
          <circle cx='400' cy='300' r='120' fill='%23ffffff' stroke='%23cfe1ff' stroke-width='18'/>
          <path d='M400 160 a1 1 0 0 1 0 240 a1 1 0 0 1 0-240' fill='%230b71ff' opacity='0.95'/>
          <text x='400' y='420' font-size='48' text-anchor='middle' fill='%230b71ff' font-family='Arial'>Enviar Localização</text>
        </g>
      </svg>" alt="Imagem inicial - inserir sua imagem acima do botão">

    <button id="sendBtn" type="button" aria-live="polite">Enviar minha localização</button>
    <div class="msg" id="status">Clique no botão para enviar sua localização.</div>

    <div class="links" id="links" style="display:none;">
      <!-- Links gerados dinamicamente -->
    </div>

    <small class="hint">Funciona em iOS e Android. Você pode trocar as imagens direto no arquivo.</small>
  </div>

  <script>
    // Elementos
    const btn = document.getElementById('sendBtn');
    const statusEl = document.getElementById('status');
    const mainImg = document.getElementById('mainImage');
    const linksWrap = document.getElementById('links');

    // Imagem "enviado" (substitua pelo seu asset se quiser)
    const sentImageData = "data:image/svg+xml;utf8," + encodeURIComponent(
      "<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='800'>"
      + "<rect width='100%' height='100%' fill='%23e9fff0'/>"
      + "<g transform='translate(200,120)'>"
      + "<circle cx='400' cy='300' r='120' fill='%23fff' stroke='%23cfeed9' stroke-width='18'/>"
      + "<text x='400' y='410' font-size='56' text-anchor='middle' fill='%2322a153' font-family='Arial'>Enviado ✓</text>"
      + "</g></svg>"
    );

    function formatCoords(lat, lon) {
      return lat.toFixed(6) + ", " + lon.toFixed(6);
    }

    function createLink(text, href) {
      const a = document.createElement('a');
      a.className = 'linkbtn';
      a.href = href;
      a.target = '_blank';
      a.rel = 'noopener noreferrer';
      a.textContent = text;
      return a;
    }

    async function handleSend() {
      btn.disabled = true;
      statusEl.innerHTML = "Obtendo localização... <span class='spinner' aria-hidden='true'></span>";

      // Tentar obter geolocalização
      if (!navigator.geolocation) {
        statusEl.textContent = "Geolocalização não é suportada pelo seu navegador.";
        btn.disabled = false;
        return;
      }

      const geoOptions = { enableHighAccuracy: false, timeout: 10000, maximumAge: 60000 };

      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        const coordsText = formatCoords(lat, lon);

        // URLs universais / multiplataforma
        const googleMaps = `https://maps.google.com/?q=${lat},${lon}`;
        const appleMaps = `https://maps.apple.com/?q=${lat},${lon}`;
        const geoURI = `geo:${lat},${lon}?q=${lat},${lon}`; // funciona em muitos Android
        const mapsQueryLabel = encodeURIComponent("Minha localização");
        const geoURIWithLabel = `geo:${lat},${lon}?q=${lat},${lon}(${mapsQueryLabel})`;

        // Mensagem que será compartilhada
        const message = `Minha localização: ${coordsText}\nAbrir no mapa: ${googleMaps}`;

        // Mostra delays e troca de imagens: 2 segundos antes de indicar "enviado"
        statusEl.innerHTML = "Enviando localização... <span class='spinner' aria-hidden='true'></span>";

        // Primeiro tente Web Share API (mais amigável em mobile moderno)
        let didShare = false;
        if (navigator.share) {
          try {
            await navigator.share({
              title: 'Minha localização',
              text: message,
              url: googleMaps
            });
            didShare = true;
          } catch (e) {
            // usuário pode ter cancelado; seguimos com fallback
            didShare = false;
          }
        }

        // Aguarda 2 segundos (delay pedido)
        setTimeout(() => {
          // troca a imagem para a "enviado"
          mainImg.src = sentImageData;
          statusEl.textContent = didShare ? "Localização compartilhada com sucesso!" : "Localização preparada. Escolha uma opção para abrir/enviar:";
          // mostra links para abrir no mapa / enviar por e-mail
          linksWrap.innerHTML = "";

          // Link Google Maps (universal)
          linksWrap.appendChild(createLink('Abrir no Google Maps', googleMaps));
          // Link Apple Maps (bom para iOS)
          linksWrap.appendChild(createLink('Abrir no Apple Maps (iOS)', appleMaps));
          // Geo URI (Android)
          linksWrap.appendChild(createLink('Abrir (geo: URI - Android)', geoURIWithLabel));
          // Mailto (pré-preenchido)
          const mailto = `mailto:?subject=${encodeURIComponent('Minha localização')}&body=${encodeURIComponent(message)}`;
          linksWrap.appendChild(createLink('Enviar por e-mail', mailto));

          // Copiar para clipboard botão
          const copyBtn = document.createElement('button');
          copyBtn.className = 'linkbtn';
          copyBtn.type = 'button';
          copyBtn.textContent = 'Copiar coordenadas';
          copyBtn.onclick = async () => {
            try {
              await navigator.clipboard.writeText(coordsText);
              copyBtn.textContent = 'Copiado!';
              setTimeout(()=> copyBtn.textContent = 'Copiar coordenadas', 2000);
            } catch(err) {
              copyBtn.textContent = 'Falha ao copiar';
            }
          };
          linksWrap.appendChild(copyBtn);

          linksWrap.style.display = 'flex';

        }, 2000);

      }, (err) => {
        // Erros de geolocalização
        switch(err.code) {
          case err.PERMISSION_DENIED:
            statusEl.textContent = "Permissão negada. Ative a localização e tente novamente.";
            break;
          case err.POSITION_UNAVAILABLE:
            statusEl.textContent = "Localização indisponível.";
            break;
          case err.TIMEOUT:
            statusEl.textContent = "Tempo esgotado ao obter localização. Tente novamente.";
            break;
          default:
            statusEl.textContent = "Erro ao obter localização: " + (err.message || err.code);
        }
        btn.disabled = false;
      }, geoOptions);
    }

    btn.addEventListener('click', handleSend);
  </script>
</body>
</html>
